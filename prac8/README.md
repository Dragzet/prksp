# Практическая работа №8 - Ролевая модель (RBAC)

Полнофункциональное приложение с разделением пользователей по ролям (Role-Based Access Control).

## Описание

Система управления с двумя ролями:
- **Администратор** - полный доступ ко всем данным и функциям
- **Пользователь** - доступ только к собственным данным

## Технологии

### Backend
- Node.js + Express
- PostgreSQL + Sequelize ORM
- JWT для аутентификации
- bcryptjs для хеширования паролей

### Frontend
- React 18
- React Router v6
- Axios для API запросов
- CSS Modules

## Структура проекта

```
prac8/
├── backend/
│   ├── models/
│   │   ├── User.js          # Модель пользователя
│   │   └── Item.js          # Модель элемента
│   ├── routes/
│   │   ├── auth.js          # Маршруты аутентификации
│   │   └── items.js         # Маршруты CRUD операций
│   ├── middleware/
│   │   └── auth.js          # Middleware для проверки ролей
│   ├── server.js            # Точка входа сервера
│   ├── package.json
│   └── .env
└── frontend/
    ├── src/
    │   ├── api/
    │   │   └── api.js       # API клиент
    │   ├── components/
    │   │   ├── Navbar.js    # Навигация
    │   │   └── PrivateRoute.js  # Защищенные маршруты
    │   ├── context/
    │   │   └── AuthContext.js   # Контекст аутентификации
    │   ├── pages/
    │   │   ├── Home.js      # Главная страница
    │   │   ├── Login.js     # Страница входа
    │   │   ├── Register.js  # Страница регистрации
    │   │   └── Dashboard.js # Панель управления
    │   ├── App.js
    │   └── index.js
    └── package.json
```

## Установка и запуск

### Предварительные требования
- Node.js (v14+)
- PostgreSQL (v12+)
- npm или yarn

### Backend

1. Перейдите в папку backend:
```bash
cd backend
```

2. Установите зависимости:
```bash
npm install
```

3. Настройте PostgreSQL:
   - Установите PostgreSQL если еще не установлен
   - Создайте базу данных:
   ```sql
   CREATE DATABASE prac8_rbac;
   ```

4. Настройте `.env` файл:
```
PORT=5000
DB_HOST=localhost
DB_PORT=5432
DB_NAME=prac8_rbac
DB_USER=postgres
DB_PASSWORD=postgres
JWT_SECRET=your_jwt_secret_key_change_this_in_production
NODE_ENV=development
```

5. Запустите сервер:
```bash
npm start
# или для режима разработки с автоперезагрузкой:
npm run dev
```

При первом запуске Sequelize автоматически создаст необходимые таблицы.

Сервер запустится на `http://localhost:5000`

### Frontend

1. Перейдите в папку frontend:
```bash
cd frontend
```

2. Установите зависимости:
```bash
npm install
```

3. Запустите приложение:
```bash
npm start
```

Приложение откроется на `http://localhost:3000`

## Функционал

### Роли и права доступа

#### Администратор (admin)
- ✅ Просмотр всех элементов в системе
- ✅ Создание новых элементов
- ✅ Редактирование любых элементов
- ✅ Удаление любых элементов
- ✅ Просмотр информации о владельцах

#### Пользователь (user)
- ✅ Просмотр только своих элементов
- ✅ Создание новых элементов
- ✅ Редактирование только своих элементов
- ✅ Удаление только своих элементов
- ❌ Нет доступа к элементам других пользователей

### Основные возможности

1. **Аутентификация**
   - Регистрация с выбором роли
   - Вход с JWT токеном
   - Автоматический выход при истечении токена

2. **CRUD операции**
   - Create (Создание) - доступно всем
   - Read (Чтение) - с фильтрацией по роли
   - Update (Обновление) - только владелец или админ
   - Delete (Удаление) - только владелец или админ

3. **Защита маршрутов**
   - Private Routes - требуют аутентификации
   - Role-based access control на уровне API
   - Проверка прав на frontend и backend

## API Endpoints

### Аутентификация
- `POST /api/auth/register` - Регистрация
- `POST /api/auth/login` - Вход

### Элементы
- `GET /api/items` - Получить элементы (с фильтрацией по роли)
- `GET /api/items/:id` - Получить элемент по ID
- `POST /api/items` - Создать элемент
- `PUT /api/items/:id` - Обновить элемент
- `DELETE /api/items/:id` - Удалить элемент

## Безопасность

- Пароли хешируются с помощью bcrypt
- JWT токены с истечением через 24 часа
- Проверка прав на каждом API endpoint
- Защита от несанкционированного доступа
- Валидация данных с express-validator

## Тестирование

### Создание тестовых пользователей

После запуска приложения зарегистрируйте:

1. **Администратора:**
   - Username: admin
   - Email: admin@example.com
   - Password: admin123
   - Role: admin

2. **Пользователя:**
   - Username: user
   - Email: user@example.com
   - Password: user123
   - Role: user

## Примеры использования

### Сценарий 1: Пользователь создает элемент
1. Войдите как пользователь
2. Нажмите "Создать элемент"
3. Заполните форму
4. Элемент будет виден только вам

### Сценарий 2: Администратор управляет всеми элементами
1. Войдите как администратор
2. Увидите все элементы всех пользователей
3. Можете редактировать и удалять любые элементы

### Сценарий 3: Попытка редактирования чужого элемента
1. Войдите как пользователь
2. Попробуйте отредактировать чужой элемент
3. Получите ошибку "Доступ запрещен"

## Разработка

Проект реализован согласно заданию практической работы №8:
- ✅ Ролевая модель (RBAC)
- ✅ Разделение пользователей
- ✅ Разные права для ролей
- ✅ React + Node.js + PostgreSQL
- ✅ Аутентификация и авторизация
- ✅ Защита маршрутов

## Возможные улучшения

- Добавление дополнительных ролей (модератор, редактор)
- Реализация ABAC (Attribute-Based Access Control)
- Логирование действий пользователей
- Пагинация для больших списков
- Поиск и фильтрация элементов
- Загрузка файлов
- Email уведомления

## Автор

Практическая работа №8 - Ролевые модели

## Лицензия

ISC
